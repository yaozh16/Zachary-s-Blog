<!DOCTYPE html>
<html>
<head><meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width"><link rel="stylesheet" type="text/css" media="all" href="../css/article_styles.css"><script type='text/x-mathjax-config'>  MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$']]}});</script><script type='text/javascript' src='http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script></head>
<body><div class='content'><h1 id="2018-2-6 JavaScript Note 6">2018-2-6 JavaScript Note 6</h1>
<h2 id="浏览器">浏览器</h2>
<h4 id="浏览器对象">浏览器对象</h4>
<h5 id="1. window">1. window</h5>
&emsp;window对象有innerWidth和innerHeight属性，可以获取浏览器窗口的内部宽度和高度。内部宽高是指除去菜单栏、工具栏、边框等占位元素后，用于显示网页的净宽高。
&emsp;对应的，还有一个outerWidth和outerHeight属性，可以获取浏览器窗口的整个宽高
<h5 id="2. navigator">2. navigator</h5>
navigator对象表示浏览器的信息，最常用的属性包括：<div class="liRank0"><li class="liRank0">navigator.appName：浏览器名称；</li></div><div class="liRank0"><li class="liRank0">navigator.appVersion：浏览器版本；</li></div><div class="liRank0"><li class="liRank0">navigator.language：浏览器设置的语言；</li></div><div class="liRank0"><li class="liRank0">navigator.platform：操作系统类型；</li></div><div class="liRank0"><li class="liRank0">navigator.userAgent：浏览器设定的User-Agent字符串</li></div>

<strong>使用短路运算符||计算，少用if</strong>
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>var width = window.innerWidth || document.body.clientWidth;
</blockquote></pre></div>
<h5 id="3. screen">3. screen</h5>
screen对象表示屏幕的信息，常用的属性有：<div class="liRank0"><li class="liRank0">screen.width：屏幕宽度，以像素为单位；</li></div><div class="liRank0"><li class="liRank0">screen.height：屏幕高度，以像素为单位；</li></div><div class="liRank0"><li class="liRank0">screen.colorDepth：返回颜色位数，如8、16、24。</li></div>
<h5 id="4. location">4. location</h5>
location对象表示当前页面的URL信息。例如，一个完整的URL
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>http://www.example.com:8080/path/index.html?a=1&amp;b=2#TOP
</blockquote></pre></div>
可以用location.href获取。要获得URL各个部分的值，可以这么写：
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>location.protocol; // &apos;http&apos;
location.host; // &apos;www.example.com&apos;
location.port; // &apos;8080&apos;
location.pathname; // &apos;/path/index.html&apos;
location.search; // &apos;?a=1&amp;b=2&apos;
location.hash; // &apos;TOP&apos;
</blockquote></pre></div>
要加载一个新页面，可以调用 location.assign()。
如果要重新加载当前页面，调用 location.reload() 方法非常方便。
<h5 id="5. document">5. document</h5>
document对象表示当前页面。由于HTML在浏览器中以DOM形式表示为树形结构，document对象就是整个DOM树的根节点。
<div class="liRank0"><li class="liRank0">document的title属性是从HTML文档中的<title>xxx</title>读取的，但是可以动态改变：</li></div>
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>document.title = &apos;努力学习JavaScript!&apos;;
</blockquote></pre></div><div class="liRank0"><li class="liRank0">用document对象提供的getElementById()和getElementsByTagName().、document.getElementsByClassName()可以按ID获得一个DOM节点和按Tag名称、按CSS的Class名称获得一组DOM节点：</li></div>
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>var menu = document.getElementById(&apos;drink-menu&apos;);
menu.tagName; // &apos;DL&apos;

var drinks = document.getElementsByTagName(&apos;dt&apos;);
s = &apos;提供的饮料有:&apos;;
for (i=0; i&lt;drinks.length; i++) {
    s = s + drinks[i].innerHTML + &apos;,&apos;;
}
console.log(s);
</blockquote></pre></div><div class="liRank0"><li class="liRank0">document对象还有一个cookie属性，可以获取当前页面的Cookie。</li></div>

&emsp;如果引入的第三方的JavaScript中存在恶意代码，则www.foo.com网站将直接获取到www.example.com网站的用户登录信息。
&emsp;为了解决这个问题，服务器在设置Cookie时可以使用httpOnly，设定了httpOnly的Cookie将不能被JavaScript读取。这个行为由浏览器实现，主流浏览器均支持httpOnly选项，IE从IE6 SP1开始支持。
&emsp;为了确保安全，服务器端在设置Cookie时，应该始终坚持使用httpOnly。
<h5 id="6. history">6. history</h5>
history对象保存了浏览器的历史记录，JavaScript可以调用history对象的 __back()__ 或 __forward ()__ ，相当于用户点击了浏览器的“后退”或“前进”按钮。

<h3 id="操作DOM">操作DOM</h3>
<h5 id="获取节点">获取节点</h5><div class="ulRank0"><ul class="ulRank0">1. getElementByXXX函数</ul></div>
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>var node = document.getElementById(&apos;test-div&apos;).getElementsByClassName(&apos;red&apos;);
node.firstElementChild;//获取节点node下第一个子节点
node.lastElementChild;//获取节点node下最后一个子节点
node.children;// 获取节点node下的所有直属子节点:
</blockquote></pre></div><div class="ulRank0"><ul class="ulRank0">2. querySelector()与querySelectorAll()</ul></div>
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>// 通过querySelector获取ID为q1的节点：
var q1 = document.querySelector(&apos;#q1&apos;);

// 通过querySelectorAll获取q1节点内的符合条件的所有节点：
var ps = q1.querySelectorAll(&apos;div.highlighted &gt; p&apos;);

</blockquote></pre></div>
<h3 id="修改DOM">修改DOM</h3><div class="ulRank0"><ul class="ulRank0">1. innerText</ul></div><div class="ulRank0"><ul class="ulRank0">1. innerHTML</ul></div><div class="ulRank0"><ul class="ulRank0">1. style</ul></div>
修改CSS也是经常需要的操作。DOM节点的style属性对应所有的CSS，可以直接获取或设置。因为CSS允许font-size这样的名称，但它并非JavaScript有效的属性名，所以需要在JavaScript中改写为 <strong>驼峰式命名</strong> fontSize
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>// 获取&lt;p id=&quot;p-id&quot;&gt;...&lt;/p&gt;
var p = document.getElementById(&apos;p-id&apos;);
// 设置CSS:
p.style.color = &apos;#ff0000&apos;;
p.style.fontSize = &apos;20px&apos;;
p.style.paddingTop = &apos;2em&apos;;
</blockquote></pre></div>
<h3 id="插入DOM">插入DOM</h3>
<h4 id="移动">移动</h4>
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>&lt;!-- HTML结构 --&gt;
&lt;p id=&quot;js&quot;&gt;JavaScript&lt;/p&gt;
&lt;div id=&quot;list&quot;&gt;
    &lt;p id=&quot;java&quot;&gt;Java&lt;/p&gt;
    &lt;p id=&quot;python&quot;&gt;Python&lt;/p&gt;
    &lt;p id=&quot;scheme&quot;&gt;Scheme&lt;/p&gt;
&lt;/div&gt;
</blockquote></pre></div>
把```<p id="js">JavaScript</p>```添加到```<div id="list">```的最后一项：
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>var
    js = document.getElementById(&apos;js&apos;),
    list = document.getElementById(&apos;list&apos;);
list.appendChild(js);
</blockquote></pre></div>
<h4 id="新建">新建</h4>
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>haskell = document.createElement(&apos;p&apos;);
haskell.id = &apos;haskell&apos;;
haskell.innerText = &apos;Haskell&apos;;
list.appendChild(haskell);
</blockquote></pre></div>
或者
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>var d = document.createElement(&apos;style&apos;);
d.setAttribute(&apos;type&apos;, &apos;text/css&apos;);
d.innerHTML = &apos;p { color: red }&apos;;
document.getElementsByTagName(&apos;head&apos;)[0].appendChild(d);
</blockquote></pre></div>
<h4 id="insertBefore">insertBefore</h4>
插入到指定元素之前
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>parentElement.insertBefore(newElement, referenceElement);
</blockquote></pre></div>
<h3 id="删除DOM">删除DOM</h3>
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>parentElement.removeChild(childElement);
</blockquote></pre></div>
children属性是一个只读属性，并且它在子节点变化时会实时更新
<h2 id="操作表单">操作表单</h2>
HTML表单的输入控件主要有以下几种：<div class="liRank0"><li class="liRank0">文本框，对应的```<input type="text">```，用于输入文本；</li></div><div class="liRank0"><li class="liRank0">口令框，对应的```<input type="password">```，用于输入口令；</li></div><div class="liRank0"><li class="liRank0">单选框，对应的```<input type="radio">```，用于选择一项；</li></div><div class="liRank0"><li class="liRank0">复选框，对应的```<input type="checkbox">```，用于选择多项；</li></div><div class="liRank0"><li class="liRank0">下拉框，对应的```<select>```，用于选择一项；</li></div><div class="liRank0"><li class="liRank0">隐藏文本，对应的```<input type="hidden">```，用户不可见，但表单提交时会把隐藏文本发送到服务器。</li></div>
<h3 id="获取值">获取值</h3>
如果我们获得了一个```<input>```节点的引用，就可以直接调用inputElement.value获得对应的用户输入值
<h3 id="设置值">设置值</h3>
设置值和获取值类似<div class="liRank0"><li class="liRank0">对于text、password、hidden以及select，直接设置value就可以</li></div><div class="liRank0"><li class="liRank0">对于单选框和复选框，设置checked为true或false即可。</li></div>
<h3 id="HTML5控件">HTML5控件</h3>
HTML5新增了大量标准控件，常用的包括date、datetime、datetime-local、color等，它们都使用```<input>```标签
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>&lt;input type=&quot;date&quot; value=&quot;2015-07-01&quot;&gt;
&lt;input type=&quot;datetime-local&quot; value=&quot;2015-07-01T02:03:04&quot;&gt;
&lt;input type=&quot;color&quot; value=&quot;#ff0000&quot;&gt;
</blockquote></pre></div>
<h3 id="提交表单">提交表单</h3>
JavaScript可以以两种方式来处理表单的提交（AJAX方式在后面章节介绍）。<div class="liRank0"><li class="liRank0">方式一是通过<form>元素的submit()方法提交一个表单，例如，响应一个```<button>```的click事件，在JavaScript代码中提交表单：</li></div>
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>&lt;!-- HTML --&gt;
&lt;form id=&quot;test-form&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;test&quot;&gt;
    &lt;button type=&quot;button&quot; onclick=&quot;doSubmitForm()&quot;&gt;Submit&lt;/button&gt;
&lt;/form&gt;

&lt;script&gt;
function doSubmitForm() {
    var form = document.getElementById(&apos;test-form&apos;);
    // 可以在此修改form的input...
    // 提交form:
    form.submit();
}
&lt;/script&gt;
</blockquote></pre></div><div class="liRank0"><li class="liRank0">第二种方式是响应<form>本身的onsubmit事件，在提交form时作修改：</li></div>
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>&lt;!-- HTML --&gt;
&lt;form id=&quot;test-form&quot; onsubmit=&quot;return checkForm()&quot;&gt;
    &lt;input type=&quot;text&quot; name=&quot;test&quot;&gt;
    &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;
&lt;/form&gt;

&lt;script&gt;
function checkForm() {
    var form = document.getElementById(&apos;test-form&apos;);
    // 可以在此修改form的input...
    // 继续下一步:
    return true;
}
&lt;/script&gt;
</blockquote></pre></div>
注意要return true来告诉浏览器继续提交，如果return false，浏览器将不会继续提交form，这种情况通常对应用户输入有误，提示用户错误信息后终止提交form。<div class="liRank0"><li class="liRank0">一般利用hidden传输口令和MD5后的密码等，而原本用户输入的没有name属性的```<input>```的数据不会被提交</li></div>
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>&lt;!-- HTML --&gt;
&lt;form id=&quot;login-form&quot; method=&quot;post&quot; onsubmit=&quot;return checkForm()&quot;&gt;
    &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot;&gt;
    &lt;input type=&quot;password&quot; id=&quot;input-password&quot;&gt;
    &lt;input type=&quot;hidden&quot; id=&quot;md5-password&quot; name=&quot;password&quot;&gt;
    &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;
&lt;/form&gt;

&lt;script&gt;
function checkForm() {
    var input_pwd = document.getElementById(&apos;input-password&apos;);
    var md5_pwd = document.getElementById(&apos;md5-password&apos;);
    // 把用户输入的明文变为MD5:
    md5_pwd.value = toMD5(input_pwd.value);
    // 继续下一步:
    return true;
}
&lt;/script&gt;
</blockquote></pre></div>

<h3 id="操作文件">操作文件</h3>
&emsp;在HTML表单中，可以上传文件的唯一控件就是```<input type="file">```。
&emsp;注意：当一个表单包含```<input type="file">```时，表单的enctype必须指定为multipart/form-data，method必须指定为post，浏览器才能正确编码并以multip00art/form-data格式发送表单的数据。
&emsp;出于安全考虑，浏览器只允许用户点击```<input type="file">```来选择本地文件，用JavaScript对```<input type="file">```的value赋值是没有任何效果的。当用户选择了上传某个文件后，JavaScript也无法获得该文件的真实路径
&emsp;通常，上传的文件都由后台服务器处理，JavaScript可以在提交表单时对文件扩展名做检查，以便防止用户上传无效格式的文件
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>var f = document.getElementById(&apos;test-file-upload&apos;);
var filename = f.value; // &apos;C:\fakepath\test.png&apos;
if (!filename || !(filename.endsWith(&apos;.jpg&apos;) || filename.endsWith(&apos;.png&apos;) || filename.endsWith(&apos;.gif&apos;))) {
    alert(&apos;Can only upload image file.&apos;);
    return false;
}
</blockquote></pre></div>
<h4 id="File API">File API</h4>

由于JavaScript对用户上传的文件操作非常有限，尤其是无法读取文件内容，使得很多需要操作文件的网页不得不用Flash这样的第三方插件来实现。

随着HTML5的普及，新增的File API允许JavaScript读取文件内容，获得更多的文件信息。

HTML5的File API提供了File和FileReader两个主要对象，可以获得文件信息并读取文件。
<div class='codeBlock'><pre class='codeBlockPre'><blockquote>var
    fileInput = document.getElementById(&apos;test-image-file&apos;),//&lt;input&gt;
    info = document.getElementById(&apos;test-file-info&apos;),//&lt;p&gt;
    preview = document.getElementById(&apos;test-image-preview&apos;);//&lt;div&gt;
// 监听change事件:
fileInput.addEventListener(&apos;change&apos;, function () {
    // 清除背景图片:
    preview.style.backgroundImage = &apos;&apos;;
    // 检查文件是否选择:
    if (!fileInput.value) {
        info.innerHTML = &apos;没有选择文件&apos;;
        return;
    }
    // 获取File引用:
    var file = fileInput.files[0];
    // 获取File信息:
    info.innerHTML = &apos;文件: &apos; + file.name + &apos;&lt;br&gt;&apos; +
                     &apos;大小: &apos; + file.size + &apos;&lt;br&gt;&apos; +
                     &apos;修改: &apos; + file.lastModifiedDate;
    if (file.type !== &apos;image/jpeg&apos; &amp;&amp; file.type !== &apos;image/png&apos; &amp;&amp; file.type !== &apos;image/gif&apos;) {
        alert(&apos;不是有效的图片文件!&apos;);
        return;
    }
    // 读取文件:
    var reader = new FileReader();
    reader.onload = function(e) {
        var
            data = e.target.result; // &apos;data:image/jpeg;base64,/9j/4AAQSk...(base64编码)...&apos;            
        //显示预览
        preview.style.backgroundImage = &apos;url(&apos; + data + &apos;)&apos;;
    };
    // 以DataURL的形式读取文件:
    reader.readAsDataURL(file);
});
</blockquote></pre></div></div></body>
</html>
